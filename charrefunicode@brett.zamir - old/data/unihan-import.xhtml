<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>
<textarea id="results" rows="1020" cols="500"></textarea>
<textarea id="errors" rows="12" cols="50"></textarea>
<script type="text/javascript"><![CDATA[

// Setup to overcome restriction on file:// URLS in Firefox (Chrome, Opera disallow, but works in Safari)
function addScript (files, checkVars, cb, checkback) {
    if (typeof files === 'string') {
        files = [files];
        checkVars = [checkVars];
    }
    for (var i=0, filelen = files.length; i < filelen; i++) {
        var file = files[i];
        var baseURL = window.location.href.substring(0, window.location.href.lastIndexOf('/')+1),
            script = document.createElement('script');
        script.src = baseURL + file;
        document.getElementsByTagName('head')[0].appendChild(script);
    }
    var interval = setInterval(function () {
        for (var j = 0, cvl = checkVars.length; j < cvl; j++) {
            if (typeof window[checkVars[j]] === 'undefined') {
                return;
            }
            checkVars.splice(j, 1);
        }
        clearInterval(interval);
        cb(baseURL);
    }, checkback || 100);
}

addScript(['file_get_and_ksort.min.js', 'import-helpers.js'], ['file_get_contents', '$'], function (baseURL) {
    ini_set('phpjs.strictForIn', true);
    
    var fields = ['code_pt','kAccountingNumeric','kBigFive','kCCCII','kCNS1986','kCNS1992','kCangjie','kCantonese',
                    'kCheungBauer','kCheungBauerIndex','kCihaiT','kCompatibilityVariant','kCowles','kDaeJaweon',
                    'kDefinition','kEACC','kFenn','kFennIndex','kFourCornerCode','kFrequency','kGB0','kGB1','kGB3',
                    'kGB5','kGB7','kGB8','kGSR','kGradeLevel','kHDZRadBreak','kHKGlyph','kHKSCS','kHanYu','kHangul',
                    'kHanyuPinlu','kHanyuPinyin','kIBMJapan','kIICore','kIRGDaeJaweon','kIRGDaiKanwaZiten',
                    'kIRGHanyuDaZidian','kIRGKangXi','kIRG_GSource','kIRG_HSource','kIRG_JSource','kIRG_KPSource',
                    'kIRG_KSource','kIRG_MSource','kIRG_TSource','kIRG_USource','kIRG_VSource','kJIS0213','kJapaneseKun',
                    'kJapaneseOn','kJis0','kJis1','kKPS0','kKPS1','kKSC0','kKSC1','kKangXi','kKarlgren','kKorean','kLau',
                    'kMainlandTelegraph','kMandarin','kMatthews','kMeyerWempe','kMorohashi','kNelson','kOtherNumeric',
                    'kPhonetic','kPrimaryNumeric','kPseudoGB1','kRSAdobe_Japan1_6','kRSJapanese','kRSKanWa','kRSKangXi',
                    'kRSKorean','kRSUnicode','kSBGY','kSemanticVariant','kSimplifiedVariant','kSpecializedSemanticVariant',
                    'kTaiwanTelegraph','kTang','kTotalStrokes','kTraditionalVariant','kVietnamese','kXHC1983','kXerox','kZVariant'];
    baseURL = baseURL + 'unihan/';
    var scriptFileAsStr = file_get_contents(baseURL + 'Unihan_DictionaryIndices.txt')+
                            file_get_contents(baseURL + 'Unihan_DictionaryLikeData.txt')+
                            file_get_contents(baseURL + 'Unihan_IRGSources.txt')+
                            file_get_contents(baseURL + 'Unihan_NumericValues.txt')+
                            file_get_contents(baseURL + 'Unihan_OtherMappings.txt')+
                            file_get_contents(baseURL + 'Unihan_RadicalStrokeCounts.txt')+
                            file_get_contents(baseURL + 'Unihan_Readings.txt')+
                            file_get_contents(baseURL + 'Unihan_Variants.txt');
    
    var obj = {}, lineRegex = /^U\+([\da-fA-F]{4,6})\t(\w+?)\t(.*)$/gm;
    while ((line = (lineRegex).exec(scriptFileAsStr)) != null) {
        var cdpt = line[1], col = line[2], value = line[3];
        if (!obj[cdpt]) {
            obj[cdpt] = [];
            fields.forEach(function (value, idx) {
                obj[cdpt][idx] = '';
            });
            obj[cdpt][0] = cdpt;
        }
        var pos = fields.indexOf(col);
        if (pos === -1) {
            $('errors').value += 'Not present: '+ col + '\n';
        }
        obj[cdpt][pos] = value;
    }
    uksort(obj, function (k1, k2) {
        return parseInt(k1, 16) > parseInt(k2, 16);
    });
    // Works but FF crashes with this--Chrome is ok
    scriptFileAsStr = '';
    for (var p in obj) {
        //$('results').value += JSON.stringify(obj[p]).slice(1, -1) + '\n';
        scriptFileAsStr += JSON.stringify(obj[p]).slice(1, -1) + '\n';
    }
    $('results').value = scriptFileAsStr;
    // $('results').value = JSON.stringify(obj);
});

]]></script>
</body></html>